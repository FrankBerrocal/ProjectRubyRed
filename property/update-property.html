<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Update Property</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body onload="checkProperties()">
    <nav>
        <ul class="navigation">
            <!-- no href needed since it's working hiding/showing divs. -->
            <li><a href="/property/create" id="" onclick="">Create</a></li>
            <li><a href="/property/update" id="" onclick="">Update</a></li>
            <li><a href="/property/delete" id="" onclick="">Delete</a></li>
            <li><a href="/property/api" id="" onclick="">List All</a></li>
        </ul>
    </nav>

    <div class="mainPage">
        <div id="profilePage">

            <h1>Update Workspace</h1>
            <form action="http://localhost:1007/property/property-updated" method="POST">
                <label for="name">Select Property:</label>
                <select name="name" id="name" onchange="UpdateFields()">
                    <option>Choose a Property</option>
                </select><br><br>

                <label for="adress">Address:</label>
                <input type="text" id="address" name="address"><br><br>

                <label for="type">Select Property type:</label>
                <select name="type" id="type">
                    <option value="????">????</option>
                    <option value="????">????</option>
                    <option value="???">????</option>
                </select><br><br>


                <input type="radio" id="no-parking" name="park" value="no" checked="checked">
                <label for="no-parking">No Parking</label>
                <input type="radio" id="parking" name="park" value="yes">
                <label for="parking">Parking Available</label><br><br>


                <input type="radio" id="no-public" name="transport" value="no" checked="checked">
                <label for="no-public">No Public Transportation</label>
                <input type="radio" id="public" name="transport" value="yes">
                <label for="public">Public Transportation</label><br><br>

                <input type="radio" id="no-smoking" name="smoking" value="no" checked="checked">
                <label for="no-smoking">Non-smoking</label>
                <input type="radio" id="smoking" name="smoking" value="yes">
                <label for="smoking">Smoking</label><br><br>

                <label for="seats">Number of Individuals:</label>
                <input type="range" name="individuals" min="1" max="100" step="1" value="1"
                    oninput="num.value = this.value">
                <output id="num">1</output><br><br>

                <label for="availability">Available from:</label>
                <input type="date" id="availabilityFrom" name="availabilityFrom"><br><br>

                <label for="availability">Available To:</label>
                <input type="date" id="availabilityTo" name="availabilityTo"><br><br>

                <label for="leaseterm">Lease term:</label>
                <input type="radio" id="ltday" name="leaseterm" value="day" checked="checked">
                <label for="leaseterm">Day</label>
                <input type="radio" id="ltdweek" name="leaseterm" value="week">
                <label for="leaseterm">Week</label>
                <input type="radio" id="ltdmonth" name="leaseterm" value="month">
                <label for="leaseterm">Month</label><br><br>

                <label for="price">Price:</label>
                <input type="text" id="price" name="price"><br><br>

                <input type="submit" value="Create">
            </form>
        </div>
    </div>

    <div class="bottomBar">
        Webpage by Colin From, Frank Berrocal, Pedro Ferreira and Peter Kosa, for SODV1201 - Final Project.
        Copyright
        2022.
    </div>

    <script>
        const select = document.getElementById('name');

        function checkProperties() {
            alert("I am running.")
            fetch('/currentUser')
                .then(res => res.json())
                .then(function (data) {
                    alert(data.fName)
                    data.properties.forEach(element => {
                        var option = document.createElement('option');
                        option.value = element.name;
                        option.textContent = element.name;
                        select.appendChild(option);
                    })
                }
                )
                .catch(err => alert("I got an error on the API."))
        }


        function UpdateFields() {
            fetch('/currentUser')
                .then(res => res.json())
                .then(function (data) {
                    data.properties.forEach(element => {
                        if (element.name == document.getElementById("name").value) {

                            document.getElementById('address').value = element.address;
                            document.getElementById('type').value = element.type;
                            document.getElementById('price').value = element.price;
                            document.getElementById('num').value = element.seats;

                            if (element.park == 'no') {
                                document.getElementById('smoking').checked = false;
                                document.getElementById('no-smoking').checked = true;
                            }
                            if (element.park == 'yes') {
                                document.getElementById('parking').checked = true;
                                document.getElementById('no-parking').checked = false;
                            }

                            if (element.transport == 'no') {
                                document.getElementById('public').checked = false;
                                document.getElementById('no-public').checked = true;
                            }
                            if (element.transport == 'yes') {
                                document.getElementById('public').checked = true;
                                document.getElementById('no-public').checked = false;
                            }


                            if (element.smoking == 'no') {
                                document.getElementById('smoking').checked = false;
                                document.getElementById('no-smoking').checked = true;
                            }
                            if (element.smoking == 'yes') {
                                document.getElementById('smoking').checked = true;
                                document.getElementById('no-smoking').checked = false;
                            }

                            document.getElementById('availabilityFrom').value = element.availabilityFrom;
                            document.getElementById('availabilityTo').value = element.availabilityTo;

                            if (element.leaseterm == 'day') {
                                document.getElementById('ltday').checked = true;
                                document.getElementById('ltdweek').checked = false;
                                document.getElementById('ltdmonth').checked = false;
                            }
                            if (element.leaseterm == 'week') {
                                document.getElementById('ltday').checked = false;
                                document.getElementById('ltdweek').checked = true;
                                document.getElementById('ltdmonth').checked = false;
                            }
                            if (element.leaseterm == 'month') {
                                document.getElementById('ltday').checked = false;
                                document.getElementById('ltdweek').checked = false;
                                document.getElementById('ltdmonth').checked = true;
                            }
                        }
                    })

                }
                )
                .catch(err => alert("I got an error on the API."))
        }


    </script>
</body>

</html>