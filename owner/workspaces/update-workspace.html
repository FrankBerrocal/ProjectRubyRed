<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Update Workspace</title>
    <link rel="stylesheet" href="/css/styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body onload="checkProperties()">
    <nav>
        <ul class="navigation">
            <!-- no href needed since it's working hiding/showing divs. -->
            <li><a href="create" id="" onclick="">Create</a></li>
            <li><a href="update" id="" onclick="">Update</a></li>
            <li><a href="delete" id="" onclick="">Delete</a></li>
            <li><a href="api" id="" onclick="">List All</a></li>
        </ul>
    </nav>

    <div class="mainPage">
        <div id="profilePage">

            <h1>Update Workspace</h1>
            <form action="http://localhost:1007/owner/workspaces/workspace-updated" method="POST">
                <label for="property">Select Property:</label>
                <select name="property" id="property" onchange="updateWorkspaces()">
                    <option>Choose a Property</option>
                </select><br><br>

                <label for="types">Select workspace:</label>
                <select name="types" id="types" onchange="updateFee()">
                    <option>Choose a workspace</option>
                </select><br><br>

                <input type="text" id="id" name="id"><br><br>

                <label for="name">Name of the workspace:</label>
                <input type="text" id="name" name="name"><br><br>

                <label for="type">Select workspace type:</label>
                <select name="type" id="type">
                    <option value="meeting-room">Meeting Room</option>
                    <option value="private-workspace">Private Office Room</option>
                    <option value="open-desk">Open Desk</option>
                </select><br><br>

                <input type="radio" id="no-smoking" name="smoking" value="no" checked="checked">
                <label for="no-smoking">Non-smoking</label>
                <input type="radio" id="smoking" name="smoking" value="yes">
                <label for="smoking">Smoking</label><br><br>

                <label for="seats">Number of seats:</label>
                <input type="range" name="seats" id="seats" min="1" max="10" step="1" value="1"
                    oninput="num.value = this.value">
                <output id="num">1</output><br><br>

                <label for="availability">Available from:</label>
                <input type="date" id="availability" name="availability"><br><br>

                <label for="leaseterm">Lease term:</label>
                <input type="radio" id="ltday" name="leaseterm" value="day" checked="checked">
                <label for="leaseterm">Day</label>
                <input type="radio" id="ltdweek" name="leaseterm" value="week">
                <label for="leaseterm">Week</label>
                <input type="radio" id="ltdmonth" name="leaseterm" value="month">
                <label for="leaseterm">Month</label><br><br>

                <label for="price">Price:</label>
                <input type="text" id="price" name="price"><br><br>

                <label for="listed">Is it listed?</label>
                <input type="radio" id="listed" name="listed" value="yes" checked="checked">
                <label for="listed">Yes</label>
                <input type="radio" id="not-listed" name="listed" value="no">
                <label for="listed">No</label><br><br>

                <input type="submit" value="Update">
            </form>
        </div>
    </div>

    <div class="bottomBar">
        Webpage by Colin From, Frank Berrocal, Pedro Ferreira and Peter Kosa, for SODV1201 - Final Project.
        Copyright
        2022.
    </div>

    <script>
        const propertySelect = document.getElementById('property');
        const workspaceSelect = document.getElementById('types');

        $("#property").change(function () {
            var propertyName = $("#property option:selected");
            console.log(propertyName.text);
        })


        function checkProperties() {
            fetch('/currentUser')
                .then(res => res.json())
                .then(function (data) {
                    data.properties.forEach(element => {
                        var option = document.createElement('option');
                        option.value = element.name;
                        option.textContent = element.name;
                        propertySelect.appendChild(option);
                    })



                    // const currentProperty = data.properties.find( // Find property that matches propertyName
                    //     property => property.name === propertyName
                    // );

                })
                .catch(err => alert("I got an error on the API."))
        }



        // $("#types").change(function () {
        //     var selectWorkspace = $("#types option:selected");
        //     //console.log(selectWorkspace.text());
        // })

        // $.getJSON("/data/data.json", function (json) {
        //     //console.log(json);
        //     json.Workspaces.forEach(element => {
        //         var option = document.createElement('option');
        //         option.value = element.name;
        //         option.textContent = element.name;
        //         select.appendChild(option);
        //     });
        // })


        function updateFee() {

            const selectWorkspaceElement = document.getElementById('types');
            const idElement = document.getElementById('id');
            const nameElement = document.getElementById('name');
            const typeElement = document.getElementById('type');
            const priceElement = document.getElementById('price');
            const seatsElement = document.getElementById('seats');
            const seatsOutputElement = document.getElementById('num');
            const availabilityElement = document.getElementById('availability');
            const smokingNoElement = document.getElementById('no-smoking');
            const smokingYesElement = document.getElementById('smoking');
            const leasetermDayElement = document.getElementById('ltday');
            const leasetermWeekElement = document.getElementById('ltdweek');
            const leasetermMonthElement = document.getElementById('ltdmonth');
            const listedYesElement = document.getElementById('listed');
            const listedNoElement = document.getElementById('not-listed');

            var name = selectWorkspaceElement.value;

            $.getJSON("/data/data.json", function (json) {
                var selectedWorkspace = json.Workspaces.find(workspace => workspace.name === name);

                idElement.value = selectedWorkspace.id;
                nameElement.value = selectedWorkspace.name;
                typeElement.value = selectedWorkspace.type;
                seatsElement.value = selectedWorkspace.seats;
                seatsOutputElement.value = selectedWorkspace.seats;
                priceElement.value = selectedWorkspace.price;
                availabilityElement.value = selectedWorkspace.availability;

                // Smoking radio buttons
                if (selectedWorkspace.smoking == 'no') {
                    smokingNoElement.checked = true;
                }
                else if (selectedWorkspace.smoking == 'yes') {
                    smokingYesElement.checked = true;
                }

                // Lease term radio buttons
                if (selectedWorkspace.leaseterm == 'day') {
                    leasetermDayElement.checked = true;
                }
                else if (selectedWorkspace.leaseterm == 'week') {
                    leasetermWeekElement.checked = true;
                }
                else if (selectedWorkspace.leaseterm == 'month') {
                    leasetermMonthElement.checked = true;
                }

                // Listed radio buttons
                if (selectedWorkspace.listed == 'yes') {
                    listedYesElement.checked = true;
                }
                else if (selectedWorkspace.listed == 'no') {
                    listedNoElement.checked = true;
                }
            })
        }

        function updateWorkspaces() {
            fetch('/currentUser')
                .then(res => res.json())
                .then(function (data) {
                    var selectList = document.getElementById('types')
                    for (let i = selectList.options.length; i > 0; i--) {
                        selectList.remove(i);
                    }
                    for (let i = 0; i < data.properties.length; i++) {
                        if (data.properties[i].name == propertySelect.value) {
                            data.properties[i].workspaces.forEach(element => {
                                var option = document.createElement('option');
                                option.value = element.name;
                                option.textContent = element.name;
                                workspaceSelect.appendChild(option);
                            })
                        }
                    }
                })
                .catch(err => alert("I got an error on the API."))
        }

    </script>
</body>

</html>